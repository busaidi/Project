<!DOCTYPE html>
<html>
<head>
    <title>Map View</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v9.2.4/ol.css">
    <style>
        .map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map" class="map"></div>
<div id="info" style="position: absolute; bottom: 10px; left: 10px; background: rgba(255, 255, 255, 0.8); padding: 10px;"></div>
<script src="https://cdn.jsdelivr.net/npm/ol@v9.2.4/dist/ol.js"></script>
<script>
    console.log("Initializing map...");
    const map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([57.0000, 23.0000]),
            zoom: 7
        })
    });
    console.log("Map initialized.");

    const urls = {
        'tracks': 'http://localhost:8000/api/tracks/',
        'ducts': 'http://localhost:8000/api/ducts/',
        'subducts': 'http://localhost:8000/api/subducts/',
        'cables': 'http://localhost:8000/api/cables/'
    };

    const styles = {
        'tracks': new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'blue',
                width: 2
            })
        }),
        'ducts': new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'green',
                width: 2
            })
        }),
        'subducts': new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'orange',
                width: 2
            })
        }),
        'cables': new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'red',
                width: 2
            })
        })
    };

    for (const [key, url] of Object.entries(urls)) {
        fetch(url)
            .then(response => response.json())
            .then(data => {
                console.log(`Data fetched from ${url}: `, data);
                const features = new ol.format.GeoJSON().readFeatures(data, {
                    featureProjection: 'EPSG:3857'
                });
                const vectorSource = new ol.source.Vector({
                    features: features
                });
                const vectorLayer = new ol.layer.Vector({
                    source: vectorSource,
                    style: styles[key]
                });
                map.addLayer(vectorLayer);
                console.log(`Layer for ${key} added to map.`);
            });
    }

    // Function to handle feature clicks
    function handleFeatureClick(event) {
        map.forEachFeatureAtPixel(event.pixel, function (feature) {
            const props = feature.getProperties();
            let info = '';
            for (let key in props) {
                if (key !== 'geometry') {
                    info += `${key}: ${props[key]}<br>`;
                }
            }
            document.getElementById('info').innerHTML = info;
        });
    }

    // Adding click event listener to the map
    map.on('click', handleFeatureClick);
</script>
</body>
</html>
